# 5. 로그 관리

## 5.1 로그의 정기적 검토 및 보고

### 1. **로그 분석 계획 수립 여부 점검**

- 주기적인 로그 분석 계획 및 정책이 수립되어 있는지 확인

```bash
ls -l /etc/cron.daily/
ls -l /etc/cron.weekly/
cat /etc/crontab
ls -l /etc/logrotate.d/
ls /etc/logrotate.d/
````

---

### 2. **로그 파일 점검 항목**

#### 📌 utmp, wtmp, btmp 로그

```bash
# 현재 로그인 사용자 확인
who

# 과거 로그인 기록
last

# 실패한 로그인 시도 기록
lastb  # /var/log/btmp 파일 기반

# 마지막으로 성공한 로그인 기록
lastlog  # /var/log/lastlog
```

---

#### 📌 sulog (su 명령 기록)

* su 명령어 사용 기록 확인: `/var/log/secure`

```bash
grep 'su:' /var/log/secure
```

##### 🔹 1. 성공적인 권한 상승

```
May 14 02:25:49 localhost su: pam_unix(su-l:session): session opened for user root by wins(uid=1000)
```

* ✅ 권한 상승 성공 (wins → root)

##### 🔹 2. 권한 상승 실패 (인증 실패)

```
May 14 07:40:12 localhost su: pam_unix(su-l:auth): authentication failure; logname=wins uid=1000 ...
```

* ❌ 비밀번호 실패

##### 🔹 3. 정책 조건 불충족

```
May 14 07:40:12 localhost su: pam_succeed_if(su-l:auth): requirement "uid >= 1000" not met by user "root"
```

* ❌ 정책에 의한 거부

##### 🔹 4. 다시 권한 상승 성공

```
May 14 07:40:22 localhost su: pam_unix(su-l:session): session opened for user root by wins(uid=1000)
```

* ✅ 재시도 후 성공

##### 🔹 5. root 계정이 su 실행 (root → root)

```
May 14 13:27:23 localhost su: pam_unix(su:session): session opened for user root by root(uid=0)
```

* ⚠ 관리자 직접 접근 확인용

---

#### 🔎 정리

| 시간    | 사용자         | 결과   | 설명                     |
| ----- | ----------- | ---- | ---------------------- |
| 02:25 | wins → root | ✅ 성공 | 권한 상승 성공               |
| 07:40 | wins → root | ❌ 실패 | 비밀번호 실패                |
| 07:40 | wins → root | ✅ 성공 | 다시 시도하여 성공             |
| 13:27 | root → root | ⚠ 무해 | root 계정의 su 실행 (무시 가능) |

> 주의: wins 계정이 반복적으로 root 전환 시도. 의도된 접근인지 확인 필요.

---

#### 📌 xferlog (FTP 로그)

* FTP 서비스 사용 시 전송 기록 확인: `/var/log/xferlog`

```bash
# xferlog 파일이 없으면 FTP 서비스 비활성화 추정
ls -l /var/log/xferlog
```

---

#### 📌 기타 중요 로그

```bash
cat /var/log/messages | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/secure | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/maillog | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/httpd/access_log | egrep -i "critical|error|warn|alert|fault|fail"
```

> 일부 로그는 출력 없음 → 해당 서비스가 미사용 중일 수 있음

---

## 5.2 정책에 따른 시스템 로깅 설정

```bash
vi /etc/rsyslog.conf
```

### Rules 예시 (설정 전/후 비교)

* 설정 전: 기본 설정
* 설정 후: 정책에 따라 추가/변경
* 적용: syslog 데몬 재시작

```bash
ps -ef | grep syslogd
kill -HUP [PID]
```
