ì•„ëž˜ëŠ” ì œê³µí•´ì£¼ì‹  ì‹¤ìŠµ ë‚´ìš©ì„ `.md` (ë§ˆí¬ë‹¤ìš´) í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•œ ë¬¸ì„œìž…ë‹ˆë‹¤.

---

````markdown
# 5. ë¡œê·¸ ê´€ë¦¬

## 5.1 ë¡œê·¸ì˜ ì •ê¸°ì  ê²€í†  ë° ë³´ê³ 

### 1. **ë¡œê·¸ ë¶„ì„ ê³„íš ìˆ˜ë¦½ ì—¬ë¶€ ì ê²€**

- ì£¼ê¸°ì ì¸ ë¡œê·¸ ë¶„ì„ ê³„íš ë° ì •ì±…ì´ ìˆ˜ë¦½ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸

```bash
ls -l /etc/cron.daily/
ls -l /etc/cron.weekly/
cat /etc/crontab
ls -l /etc/logrotate.d/
ls /etc/logrotate.d/
````

---

### 2. **ë¡œê·¸ íŒŒì¼ ì ê²€ í•­ëª©**

#### ðŸ“Œ utmp, wtmp, btmp ë¡œê·¸

```bash
# í˜„ìž¬ ë¡œê·¸ì¸ ì‚¬ìš©ìž í™•ì¸
who

# ê³¼ê±° ë¡œê·¸ì¸ ê¸°ë¡
last

# ì‹¤íŒ¨í•œ ë¡œê·¸ì¸ ì‹œë„ ê¸°ë¡
lastb  # /var/log/btmp íŒŒì¼ ê¸°ë°˜

# ë§ˆì§€ë§‰ìœ¼ë¡œ ì„±ê³µí•œ ë¡œê·¸ì¸ ê¸°ë¡
lastlog  # /var/log/lastlog
```

---

#### ðŸ“Œ sulog (su ëª…ë ¹ ê¸°ë¡)

* su ëª…ë ¹ì–´ ì‚¬ìš© ê¸°ë¡ í™•ì¸: `/var/log/secure`

```bash
grep 'su:' /var/log/secure
```

##### ðŸ”¹ 1. ì„±ê³µì ì¸ ê¶Œí•œ ìƒìŠ¹

```
May 14 02:25:49 localhost su: pam_unix(su-l:session): session opened for user root by wins(uid=1000)
```

* âœ… ê¶Œí•œ ìƒìŠ¹ ì„±ê³µ (wins â†’ root)

##### ðŸ”¹ 2. ê¶Œí•œ ìƒìŠ¹ ì‹¤íŒ¨ (ì¸ì¦ ì‹¤íŒ¨)

```
May 14 07:40:12 localhost su: pam_unix(su-l:auth): authentication failure; logname=wins uid=1000 ...
```

* âŒ ë¹„ë°€ë²ˆí˜¸ ì‹¤íŒ¨

##### ðŸ”¹ 3. ì •ì±… ì¡°ê±´ ë¶ˆì¶©ì¡±

```
May 14 07:40:12 localhost su: pam_succeed_if(su-l:auth): requirement "uid >= 1000" not met by user "root"
```

* âŒ ì •ì±…ì— ì˜í•œ ê±°ë¶€

##### ðŸ”¹ 4. ë‹¤ì‹œ ê¶Œí•œ ìƒìŠ¹ ì„±ê³µ

```
May 14 07:40:22 localhost su: pam_unix(su-l:session): session opened for user root by wins(uid=1000)
```

* âœ… ìž¬ì‹œë„ í›„ ì„±ê³µ

##### ðŸ”¹ 5. root ê³„ì •ì´ su ì‹¤í–‰ (root â†’ root)

```
May 14 13:27:23 localhost su: pam_unix(su:session): session opened for user root by root(uid=0)
```

* âš  ê´€ë¦¬ìž ì§ì ‘ ì ‘ê·¼ í™•ì¸ìš©

---

#### ðŸ”Ž ì •ë¦¬

| ì‹œê°„    | ì‚¬ìš©ìž         | ê²°ê³¼   | ì„¤ëª…                     |
| ----- | ----------- | ---- | ---------------------- |
| 02:25 | wins â†’ root | âœ… ì„±ê³µ | ê¶Œí•œ ìƒìŠ¹ ì„±ê³µ               |
| 07:40 | wins â†’ root | âŒ ì‹¤íŒ¨ | ë¹„ë°€ë²ˆí˜¸ ì‹¤íŒ¨                |
| 07:40 | wins â†’ root | âœ… ì„±ê³µ | ë‹¤ì‹œ ì‹œë„í•˜ì—¬ ì„±ê³µ             |
| 13:27 | root â†’ root | âš  ë¬´í•´ | root ê³„ì •ì˜ su ì‹¤í–‰ (ë¬´ì‹œ ê°€ëŠ¥) |

> ì£¼ì˜: wins ê³„ì •ì´ ë°˜ë³µì ìœ¼ë¡œ root ì „í™˜ ì‹œë„. ì˜ë„ëœ ì ‘ê·¼ì¸ì§€ í™•ì¸ í•„ìš”.

---

#### ðŸ“Œ xferlog (FTP ë¡œê·¸)

* FTP ì„œë¹„ìŠ¤ ì‚¬ìš© ì‹œ ì „ì†¡ ê¸°ë¡ í™•ì¸: `/var/log/xferlog`

```bash
# xferlog íŒŒì¼ì´ ì—†ìœ¼ë©´ FTP ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” ì¶”ì •
ls -l /var/log/xferlog
```

---

#### ðŸ“Œ ê¸°íƒ€ ì¤‘ìš” ë¡œê·¸

```bash
cat /var/log/messages | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/secure | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/maillog | egrep -i "critical|error|warn|alert|fault|fail"
cat /var/log/httpd/access_log | egrep -i "critical|error|warn|alert|fault|fail"
```

> ì¼ë¶€ ë¡œê·¸ëŠ” ì¶œë ¥ ì—†ìŒ â†’ í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ ë¯¸ì‚¬ìš© ì¤‘ì¼ ìˆ˜ ìžˆìŒ

---

## 5.2 ì •ì±…ì— ë”°ë¥¸ ì‹œìŠ¤í…œ ë¡œê¹… ì„¤ì •

```bash
vi /etc/rsyslog.conf
```

### Rules ì˜ˆì‹œ (ì„¤ì • ì „/í›„ ë¹„êµ)

* ì„¤ì • ì „: ê¸°ë³¸ ì„¤ì •
* ì„¤ì • í›„: ì •ì±…ì— ë”°ë¼ ì¶”ê°€/ë³€ê²½
* ì ìš©: syslog ë°ëª¬ ìž¬ì‹œìž‘

```bash
ps -ef | grep syslogd
kill -HUP [PID]
```

---

## ìžë™í™” ìŠ¤í¬ë¦½íŠ¸

### â–¶ï¸ 5.1 ë¡œê·¸ ì ê²€ ìžë™í™” ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash

output="read.txt"
echo "=== ì£¼ìš” ë¡œê·¸ì¸ ë° ì¸ì¦ ë¡œê·¸ íŒŒì¼ ì¡´ìž¬ ì—¬ë¶€ ë° ë¡œê·¸ ë‚´ìš© í™•ì¸ ===" > "$output"

declare -A files=(
    [utmp]="/var/run/utmp"
    [wtmp]="/var/log/wtmp"
    [btmp]="/var/log/btmp"
    [sulog]="/var/log/secure"
    [xferlog]="/var/log/xferlog"
)

for name in "${!files[@]}"; do
    path="${files[$name]}"
    if [ -f "$path" ]; then
        echo -e "\n[+] $name íŒŒì¼ ì¡´ìž¬: $path" >> "$output"

        case "$name" in
            utmp)
                echo ">> í˜„ìž¬ ë¡œê·¸ì¸ ì‚¬ìš©ìž ëª©ë¡ (who ëª…ë ¹ ê²°ê³¼):" >> "$output"
                who >> "$output"
                ;;
            wtmp)
                echo ">> ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê¸°ë¡ (last -n 5):" >> "$output"
                last -n 5 >> "$output"
                ;;
            btmp)
                echo ">> ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ (lastb -n 5):" >> "$output"
                lastb -n 5 >> "$output"
                ;;
            sulog|xferlog)
                echo ">> ë§ˆì§€ë§‰ 5ì¤„:" >> "$output"
                tail -n 5 "$path" >> "$output"
                ;;
        esac
    else
        echo -e "\n[-] $name íŒŒì¼ ì—†ìŒ: $path" >> "$output"
    fi
done

echo -e "\n=== ì„¤ëª… ===" >> "$output"
echo "utmp   : í˜„ìž¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìž ì •ë³´" >> "$output"
echo "wtmp   : ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê¸°ë¡ (last ëª…ë ¹ì–´ìš©)" >> "$output"
echo "btmp   : ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ (lastb ëª…ë ¹ì–´ìš©)" >> "$output"
echo "sulog  : su ëª…ë ¹ì–´ ì‚¬ìš© ë‚´ì—­ (ì—†ì„ ìˆ˜ë„ ìžˆìŒ)" >> "$output"
echo "xferlog: FTP ì „ì†¡ ê¸°ë¡ (FTP ì„œë¹„ìŠ¤ ì„¤ì • ì‹œ ìƒì„±)" >> "$output"

echo -e "\në³´ê³ ì„œê°€ 'read.txt'ì— ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤."
```

---

### â–¶ï¸ 5.2 ë¡œê¹… ì„¤ì • ì ê²€ ìžë™í™” ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash

OUTPUT="read1.txt"

if [ -f /etc/rsyslog.conf ]; then
    LOGCONF="/etc/rsyslog.conf"
elif [ -f /etc/syslog.conf ]; then
    LOGCONF="/etc/syslog.conf"
else
    echo "[!] ë¡œê·¸ ì„¤ì • íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." > "$OUTPUT"
    exit 1
fi

{
    echo "[+] ì‚¬ìš© ì¤‘ì¸ ë¡œê·¸ ì„¤ì • íŒŒì¼: $LOGCONF"

    declare -A targets=(
        ["*.info;mail.none;authpriv.none;cron.none"]="messages"
        ["authpriv.*"]="secure"
        ["mail.*"]="maillog"
        ["cron.*"]="cron"
        ["*.alert"]="dev/console"
        ["*.emerg"]="*"
    )

    echo
    echo "[*] ë¡œê·¸ ì„¤ì • ì ê²€ ê²°ê³¼:"
    echo "-----------------------------------------"

    for pattern in "${!targets[@]}"; do
        grep -E "^\s*$pattern\s+" "$LOGCONF" > /dev/null
        if [ $? -eq 0 ]; then
            echo "[O] $pattern â†’ /var/log/${targets[$pattern]} ì„¤ì • ì¡´ìž¬"
        else
            echo "[X] $pattern â†’ /var/log/${targets[$pattern]} ì„¤ì • ëˆ„ë½"
        fi
    done

    echo "-----------------------------------------"
} > "$OUTPUT"
```

```
