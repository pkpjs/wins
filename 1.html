<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE-2024-27956: WP-Automatic 플러그인 SQL Injection 취약점 분석</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            line-height: 1.6;
            margin: 20px;
            padding: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #b30000; /* Dark red */
            border-bottom: 2px solid #b30000;
            padding-bottom: 10px;
        }
        h2 {
            color: #333;
            margin-top: 30px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        li {
            margin-bottom: 5px;
        }
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        code {
            background-color: #eee;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
        }
        .code-block {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto; /* Add scroll for long code lines */
            white-space: pre-wrap; /* Preserve whitespace and wrap lines */
            word-wrap: break-word; /* Break long words */
        }
        .highlight {
            color: #d9534f; /* Bootstrap danger color */
            font-weight: bold;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .source {
            margin-top: 30px;
            font-size: 0.9em;
            color: #555;
            text-align: right;
        }
    </style>
</head>
<body>

    <h1>CVE-2024-27956: WP-Automatic 플러그인 SQL Injection 취약점 분석</h1>

    <h2>개요</h2>
    <ul>
        <li><strong>취약점 ID:</strong> CVE-2024-27956</li>
        <li><strong>취약점 유형:</strong> SQL Injection (SQL 인젝션)</li>
        <li><strong>대상 플러그인:</strong> WordPress용 <code>wp-automatic</code> (자동 콘텐츠 게시 플러그인)</li>
        <li><strong>취약 버전:</strong> <span class="highlight">3.92.0 이하 버전</span></li>
        <li><strong>CVSS 점수:</strong> 9.8 (Critical)</li>
        <li><strong>공격 벡터:</strong> 원격, <span class="highlight">인증되지 않은 사용자</span></li>
    </ul>

    <h2>취약점 상세 설명</h2>
    <p>
        이 취약점은 <code>wp-automatic</code> 플러그인의 <code>wp-automatic/inc/csv.php</code> 파일 내에서 발생합니다. 이 파일은 사용자로부터 특정 파라미터(<code>q</code>, <code>auth</code>, <code>integ</code>)를 받아 데이터베이스 작업을 수행하는 과정에서 입력값 검증이 미흡하여 발생합니다.
    </p>
    <p>
        핵심 문제는 사용자로부터 전달받은 <code>$_POST['q']</code> 값을 <code>$q</code> 변수에 저장한 뒤, 이를 워드프레스 데이터베이스 객체의 <code>$wpdb->get_results($q)</code> 메소드에 직접 전달하여 SQL 쿼리를 실행하는 부분입니다. <code>$q</code> 변수에 대한 적절한 필터링이나 이스케이프 처리가 없어 공격자가 임의의 SQL 구문을 주입할 수 있습니다.
    </p>

    <h3>보안 검증 우회</h3>
    <p>
        코드에는 몇 가지 보안 검증 로직이 존재하지만, 인증되지 않은 공격자에 의해 우회될 수 있습니다:
    </p>
    <ul>
        <li><strong>인증 확인 우회:</strong> <code>$auth</code> 파라미터와 현재 사용자 비밀번호 해시(<code>$current_user->user_pass</code>)를 비교하는 로직이 있습니다. 인증되지 않은 사용자의 경우 <code>$current_user->user_pass</code>는 NULL이 되어 <code>wp_automatic_trim()</code> 함수 결과 빈 문자열(<code>''</code>)이 됩니다. 공격자는 <code>auth</code> 파라미터 값으로 <span class="highlight">Null Byte (<code>\0</code> 또는 URL 인코딩된 <code>%00</code>)</span>를 전송하여 <code>wp_automatic_trim()</code> 함수의 결과 역시 빈 문자열로 만들어 인증 비교를 통과할 수 있습니다. (<code>'' != ''</code> 는 false)</li>
        <li><strong>무결성 검증 우회:</strong> 쿼리(<code>$q</code>)와 사용자 비밀번호를 합친 문자열의 MD5 해시(<code>$integ</code>)를 검증하는 로직이 있습니다. 인증되지 않은 사용자는 비밀번호 부분이 빈 문자열이 되므로, 공격자는 자신이 주입할 SQL 쿼리(<code>$q</code>)의 <span class="highlight">MD5 해시 값만 미리 계산</span>하여 <code>integ</code> 파라미터로 전송하면 이 검증을 통과할 수 있습니다.</li>
    </ul>
    <p>
        결과적으로, 인증되지 않은 원격 공격자도 위 조건들을 만족시키는 조작된 요청을 보냄으로써, <code>csv.php</code> 파일을 통해 데이터베이스에 대해 임의의 SQL 명령을 실행할 수 있습니다.
    </p>

    <h2>공격 시나리오 (Proof of Concept - PoC)</h2>
    <p>
        제공된 PoC 코드(Python, C)는 이 취약점을 이용하여 워드프레스 사이트에 새로운 <span class="highlight">관리자 계정('eviladmin')을 생성</span>하는 것을 목표로 합니다.
    </p>
    <ol>
        <li>공격자는 취약한 <code>csv.php</code> 엔드포인트로 조작된 HTTP POST 요청을 보냅니다.</li>
        <li><strong>사용자 생성:</strong> 첫 번째 요청에서는 <code>q</code> 파라미터에 <code>wp_users</code> 테이블에 'eviladmin' 사용자를 추가하는 <code>INSERT</code> SQL 구문을 포함시키고, 해당 구문의 MD5 해시를 <code>integ</code> 파라미터로, Null Byte를 <code>auth</code> 파라미터로 전송합니다.</li>
        <li><strong>관리자 권한 부여:</strong> 두 번째 요청에서는 <code>q</code> 파라미터에 방금 생성한 'eviladmin' 사용자의 ID를 조회하여 <code>wp_usermeta</code> 테이블에 관리자 권한(<code>wp_capabilities</code>)을 부여하는 <code>INSERT</code> 또는 <code>UPDATE</code> SQL 구문을 포함시키고, 마찬가지로 해당 구문의 MD5 해시와 Null Byte를 함께 전송합니다.</li>
    </ol>
    <p>
        공격이 성공하면, 워드프레스 관리자 페이지 및 데이터베이스에 'eviladmin'이라는 이름의 관리자 계정이 생성되어 사이트 제어권이 탈취될 수 있습니다.
    </p>
    <div class="code-block">
        # PoC 코드 실행 예시 (개념 설명용)
        # python exploit.py http://target-wordpress-site.com
        # 위 명령 실행 시, 대상 사이트에 'eviladmin' 관리자 계정(비밀번호: admin) 생성을 시도함.
    </div>


    <h2>결론 및 대응 방안</h2>
    <p>
        CVE-2024-27956은 <code>wp-automatic</code> 플러그인에 존재하는 매우 위험한 SQL Injection 취약점입니다. 인증 없이 원격에서 관리자 권한을 획득할 수 있으므로 즉각적인 조치가 필요합니다.
    </p>
    <p>
        해당 플러그인을 사용하는 워드프레스 사이트 관리자는 즉시 플러그인을 <span class="highlight">최신 버전(3.92.1 이상)으로 업데이트</span>하거나, 업데이트가 불가능할 경우 플러그인을 비활성화 또는 삭제해야 합니다.
    </p>

    <p class="source">
        원본 출처: <a href="https://securioty99.tistory.com/127" target="_blank">https://securioty99.tistory.com/127</a> [Psalm:티스토리]
    </p>

</body>
</html>